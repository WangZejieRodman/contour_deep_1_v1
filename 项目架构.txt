输入：原始点云
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
阶段1：数据预处理（离线，一次性）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ↓
自适应BEV生成（bev_generator_adaptive.py）
  · 固定层厚0.625m，中心对齐分层（8层）
  · 每层二值图 [8, 200, 200]
  · 垂直复杂度图 [200, 200]
  ↓
保存到缓存 train_adaptive/*.npz, test_adaptive/*.npz
  · 每个点云对应一个.npz文件
  · 包含：bev_layers, vcd, metadata
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
阶段2：训练（在线）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ↓
加载缓存的BEV (dataset_retrieval_adaptive.py)
  · 每次getitem随机加载anchor/positive/negative
  ↓
数据增强（训练时，每次随机）
  · 旋转：0~360°（独立随机）
  · 归一化 → 堆叠为 [9, 200, 200]
  ↓
输入网络 (retrieval_net.py)
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
网络架构
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ↓
[1] PreConv (9→32通道)
  · 提取基础特征
  ↓
[2] STN2d (旋转对齐)
  · LocalizationNetwork预测角度θ
  · 构造旋转矩阵
  · affine_grid + grid_sample
  ↓
[3] MultiScaleConv (32→128通道)
  · 3×3, 7×7, 15×15并行卷积
  · 融合多尺度特征
  ↓
[4] SpatialAttention
  · 突出重要区域
  ↓
[5] ResBlock × 3 (下采样)
  · 200→100→50→25
  ↓
[6] GlobalPooling (GAP + GMP)
  · [128, 25, 25] → [256]
  ↓
[7] FC + L2归一化
  · [256] → [128] (最终特征向量)
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
训练损失
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ↓
Triplet Loss (Hard Mining)
  · anchor, positive, negatives
  · margin = 0.6
  · 拉近正样本，推远负样本
  ↓
反向传播 → 更新参数
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
训练策略
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  · 训练集：增强 (旋转0~360°)
  · 验证集：增强 (旋转0~360°)  ← 关键改进
  · Epochs: 100
  · Optimizer: AdamW (lr=1e-4)
  · Scheduler: Cosine + Warmup
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
输出：特征向量 [128]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ↓
评估：KNN检索
  · 提取数据库和查询特征
  · 构建KNN索引
  · 计算Recall@1, 5, 10, 25
  ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
当前性能（100 epoch，验证集增强）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Recall@1 (0°):   98.43%
  Recall@1 (平均): 81.29%
  标准差:          6.48%
  
  问题：STN角度集中在 [-90°, -45°]
       缺少正角度，旋转不变性不完全
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**关键流程**：
```
点云 → 预处理(BEV缓存) → 加载+增强 → STN对齐 → 特征提取 → Triplet Loss → 输出[128]
